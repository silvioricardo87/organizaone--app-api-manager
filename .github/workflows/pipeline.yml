name: App Pipeline

on:
  push:
    tags:
      - 'v*.*.*'
    branches:
      - main
      - develop
  pull_request:
    branches:
      - main
      - develop
  workflow_dispatch:
    inputs:
      build_type:
        description: 'Build Type'
        required: true
        default: 'debug'
        type: choice
        options:
          - debug
          - release

jobs:
  # --- COMMON STAGE ---
  prepare:
    name: Shared | Prepare & Validate
    uses: ./.github/workflows/prepare.yml

  # --- WEB STAGE ---
  deploy-web:
    name: Web | Azure Static Web Apps
    needs: prepare
    if: |
      needs.prepare.outputs.build_type == 'release' && 
      (github.event_name == 'push' || github.event_name == 'workflow_dispatch')
    uses: ./.github/workflows/deploy-web.yml
    secrets: inherit

  # --- NOTIFICATION STAGE (disabled) ---
  # notify:
  #   name: Utils | Notifications
  #   needs: [prepare, deploy-web]
  #   if: always()
  #   uses: ./.github/workflows/notify.yml
  #   with:
  #     build_type: ${{ needs.prepare.outputs.build_type || 'debug' }}
  #     prepare_result: ${{ needs.prepare.result }}
  #     web_deploy_result: ${{ needs.deploy-web.result }}
  #   secrets: inherit

